<!DOCTYPE html>
<html lang="en">
<head>
<title>Loan Repayment Method Comparison Graph</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link href='https://fonts.googleapis.com/css?family=Ubuntu|Raleway' rel='stylesheet' type='text/css'>
  <!--how to link to external css sheet:<link rel="stylesheet" href="main.css" />-->	
  <!--how to link to external js: <script src="myscripts.js"></script> can be placed in body as well-->
  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    #description {
		padding-top:50px;
		height: 35vh;
		font-weight: bold;
		font-size: large;	
		border-bottom: 4px hidden #0d0d0d; 
		overflow:auto;
	}
    
	#graph {
		padding-bottom:50px;
		height: 60vh;
	}
	/*Fonts*/
	.ralewayFont {
		font-family: 'Raleway', sans-serif;
		font-size: 4.5vw;
	}
	
	.ubuntuFont {
		font-family: 'Ubuntu', sans-serif;
	}
  </style>
</head>

<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>                        
        </button>
        <a class="navbar-brand" href="http://pauljuneau.github.io/" style="font-size:13px">Paul Juneau Engineering Portfolio</a>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="http://pauljuneau.github.io/">Home</a></li>
          <li><a href="http://pauljuneau.github.io/#about">About</a></li>
          <li><a href="http://pauljuneau.github.io/#portfolio">Portfolio</a></li>
        </ul>
      </div>
    </div>
  </nav>
  
  <nav class="navbar navbar-inverse navbar-fixed-bottom">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="https://www.linkedin.com/in/pauljuneau" style="font-size:13px">CONTACT</a>
      </div>
      <ul class="nav navbar-nav navbar-right">
        <li><a target="_blank" href="https://www.linkedin.com/in/pauljuneau" class ="btn btn-primary btn-sm"><i class="fa fa-linkedin-square"></i>  
  		  </a>
  	  </li>
        <li><a href="mailto:pauljuneauengineer@gmail.com?Subject=Hello" target="_blank" class="btn btn-default btn-sm"><i class="fa fa-envelope fa-fw"></i>pauljuneauengineer@gmail.com
  		  </a>
  	  </li>
      </ul>
    </div>
  </nav>
  
  <div id="description" class="container-fluid">
    <center><h1 class="ralewayFont">Loan Repayment Method Comparison Graph</h1></center>      
    <p class="ubuntuFont">Provide loan payment details below and click save. This will generate a graph that models payments over time for monthly and daily payments. 
	<br><br>
	Monthly Payments: Pay loan once a month at a fixed amount based on yearly total payment.
	<br><br>
	Daily Payments: Pay loan daily at a fixed amount based on yearly total payment.
	</p>
  </div>
  
  <div id="userForm" class="container-fluid">
   <form>
      Current loan amount: $
      <input type="text" id="loanAmount"> 
      <br>
      What day was the loan at this amount?: 
      <input type="date" id="currentLoanDate">
      <br>
      What day of month is the loan payment on?: 
      <input type="number" id="monthlyPaymentDate" min="1" max="28">
      <br>
      &nbsp;(max choice of 28 days because of February)
      <br>
	  What would your yearly payment amount be?:
	  <input type="text" id="yearlyPaymentAmount">
	  <br>
      Annual Percentage Rate (APR): 
      <input type="text" id="apr">%
      <br>
      Time duration, in years, desired to model the differing payment methods:
      <input type="number" id="timeDuration" min="1" max="100">
      <br> 
      <input type="button" id="button" value="Save">
      <br><br>
   </form>
  </div>	
  
  <div id="graph" class="container-fluid">
    <div id="myDiv" style="width: 480px; height: 400px;"><!-- Plotly chart will be drawn inside this DIV --></div>
  </div>
  
  <script>
    function doFirst() {
      var button = document.getElementById("button");
      button.addEventListener("click", saveInput, false);
    }

    function saveInput() {
      loanAmount = document.getElementById("loanAmount");
      loanAmount = loanAmount.value;

      currentLoanDate = document.getElementById("currentLoanDate");
      currentLoanDate = currentLoanDate.value;

      monthlyPaymentDate = document.getElementById("monthlyPaymentDate");
      monthlyPaymentDate = monthlyPaymentDate.value;
	  
	  
	  yearlyPaymentAmount = document.getElementById("yearlyPaymentAmount");
	  yearlyPaymentAmount = yearlyPaymentAmount.value;
	  
      apr = document.getElementById("apr");
      apr = apr.value;

      timeDuration = document.getElementById("timeDuration");
      timeDuration = timeDuration.value;  

      alert(loanAmount + ", " + currentLoanDate + ", " + monthlyPaymentDate + ", " + yearlyPaymentAmount +", " + apr + ", " + timeDuration);

      //Store
      sessionStorage.loanAmount = loanAmount;
	  loanAmount = sessionStorage.loanAmount;
	  
      sessionStorage.currentLoanDate = currentLoanDate;
	  currentLoanDate = sessionStorage.currentLoanDate;
	  
      sessionStorage.monthlyPaymentDate = monthlyPaymentDate;
	  monthlyPaymentDate = sessionStorage.monthlyPaymentDate;
	  
	  sessionStorage.yearlyPaymentAmount = yearlyPaymentAmount;
	  yearlyPaymentAmount = sessionStorage.yearlyPaymentAmount;
	  
      sessionStorage.apr = apr;
	  apr = sessionStorage.apr;
	  
      sessionStorage.timeDuration = timeDuration;
	  timeDuration = sessionStorage.timeDuration;

	  
	  var t = timeSpanGenerator(currentLoanDate, timeDuration);
	  
	  //var t = test();
	  //console.log(t);
	  
	  loanCalc(timeSpanGenerator(currentLoanDate, timeDuration), apr, loanAmount, yearlyPaymentAmount, monthlyPaymentDate);
			
	  var yDailyTrace = loanCalc(t, apr, loanAmount, yearlyPaymentAmount, monthlyPaymentDate)[0];
	  var yMonthlyTrace = loanCalc(t, apr, loanAmount, yearlyPaymentAmount, monthlyPaymentDate)[1];
	  
	  var dailyTrace = {
		x: t,
		y: yDailyTrace,
		name: 'Daily Payments',
		type: 'scatter'
      };
	  
	  var monthlyTrace = {
		x: t,
		y: yMonthlyTrace,
		name: 'Monthly Payments',
		type: 'scatter'
      };
	  var data = [dailyTrace, monthlyTrace];
	  
      Plotly.newPlot('myDiv', data);
    }

    window.addEventListener("load", doFirst, false);
    
	/*This function is used to generate time span.
	 *The time span (years) is processed from the user. 
	 *It takes the currentLoanDate entered by user 
	 *and generates the time span from there.
	 */
	function timeSpanGenerator(currentLoanDate, timeDuration) {
		/*Acquiring function variables 
		*/
		//console.log(currentLoanDate + ", " + timeDuration);
		var strCurrentLoanDate = currentLoanDate.toString();
		var arrCurrentLoanDate = strCurrentLoanDate.split("-");
		//console.log(arrCurrentLoanDate);
		
		var year = parseInt(arrCurrentLoanDate[0]);
		
		//console.log(year);
		
		//remember: January=0, February=1, and so on
		var month = parseInt(arrCurrentLoanDate[1]) - 1;
		//console.log(month);
		
		var day = parseInt(arrCurrentLoanDate[2]);
		//console.log(day);
		
		var timeDurationYears = parseInt(timeDuration);
		var timeDurationDays =  timeDurationYears * 365;
		//debugging
		//timeDurationDays = 35;
		
		/*Put currentLoanDate as first element in array, 't'. 
		*From the day entered to the last day for calculated timeDurationDays, 
		* generate date and push onto array, 't'. 
		*/		
		var t = [currentLoanDate];
		//console.log(t);
		
		for (var i = 0; i< timeDurationDays; i++) {
			var theDate = new Date(year, month, day);
			theDate.setDate(theDate.getDate() + 1);
			//remember: January=0, February=1, and so on. So add one to month
			var month = theDate.getMonth() +1;
			var day = theDate.getDate();
			var year = theDate.getFullYear();
			newdate = year + "-" + month + "-" + day;
			month--;
			t.push(newdate);
		}
		//console.log(t);
		return t;
	}
	
	function loanCalc(t, apr, loanAmount, yearlyPaymentAmount, monthlyPaymentDate) {
		var apr = Number(apr);
		var loanAmount = Number(loanAmount);
		var yearlyPaymentAmount = Number(yearlyPaymentAmount);
		
		var monthlyPaymentAmount = yearlyPaymentAmount/12;
		var dailyPaymentAmount   = yearlyPaymentAmount/365;
		//let dpr be daily percentage rate 
		var dpr = (apr/100)/365;
		
		var count = 0;
		
		var principalDaily = [loanAmount - dailyPaymentAmount];
		var principalMonthly = 	[loanAmount];
		
		var currentDayFunction = function (t, count) { 
			var currentDay = parseInt(t[count].split("-")[2]);
			return currentDay;
			}
		
		//console.log('principalDaily'+'['+currentDayFunction(t,count)+']: ' + principalDaily[count] + ' principalMonthly'+'['+currentDayFunction(t,count)+']: ' + principalMonthly[count]);
		count++;
		
		
		for(count; count < t.length; count++) {
			if (currentDayFunction(t,count) != monthlyPaymentDate) {
				principalDaily[count] = principalDaily[count - 1] + principalDaily[count - 1]*dpr - dailyPaymentAmount;
				principalMonthly[count] = principalMonthly[count - 1] + principalMonthly[count - 1]*dpr;
			} else {
				principalDaily[count] = principalDaily[count - 1] + principalDaily[count - 1]*dpr - dailyPaymentAmount;
				principalMonthly[count] = principalMonthly[count - 1] + principalMonthly[count - 1]*dpr -monthlyPaymentAmount;
			}
			//console.log('principalDaily'+'['+currentDayFunction(t,count)+']: ' + principalDaily[count] + ' principalMonthly'+'['+currentDayFunction(t,count)+']: ' + principalMonthly[count]);
		}
		
		var y = [principalDaily, principalMonthly];
		
		//console.log(y);
		return y;
	}

  </script>
</body>
